<ion-header class="cabecalho-perfil">
  <ion-toolbar>
    <div class="linha-topo-perfil">
      <ion-title>Meu Perfil</ion-title>
    </div>

    <div class="bloco-usuario">
      <!-- Input de arquivo oculto -->
      <input 
        type="file" 
        id="fileInput" 
        (change)="onFileSelected($event)" 
        accept="image/*" 
        style="display: none;"
      >

      <div class="foto-perfil" (click)="triggerFileInput()">
        <img [src]="foto || 'assets/img/avatar.png'" alt="Foto do paciente" />
        <div class="icone-camera">
          <ion-icon name="camera-outline"></ion-icon>
        </div>
      </div>

      <div class="nome-usuario">
        <h2>{{ nome || 'Paciente' }}</h2>
        <p>Toque na foto para alterar</p>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="conteudo-perfil">
  <div class="container-perfil">

    <ion-item lines="none" class="info-pessoais">
      <ion-label class="titulo-sessao">
        Informações Pessoais
      </ion-label>

      <ion-button fill="clear" slot="end" size="small" (click)="abrirModalEdicao()">
        <ion-icon name="create-outline"></ion-icon>
      </ion-button>
    </ion-item>

    <div class="cartao-informacoes">

      <div class="user-info">
        <div class="icone-user">
          <ion-icon name="person-outline"></ion-icon>
        </div>
        <div class="texto-info">
          <span class="rotulo-user">Nome Completo</span>
          <span class="valor-user">{{ nome }}</span>
        </div>
      </div>

      <div class="cpf-info">
        <div class="icone-cpf">
          <ion-icon name="card-outline"></ion-icon>
        </div>
        <div class="texto-cpf">
          <span class="rotulo-cpf">CPF</span>
          <span class="valor-cpf">{{ formatarCpf(cpf) }}</span>
        </div>
      </div>

      <div class="dtnasc-info">
        <div class="icone-dtnasc">
          <ion-icon name="calendar-outline"></ion-icon>
        </div>
        <div class="texto-dtnasc">
          <span class="rotulo-dtnasc">Data de Nascimento</span>
          <span class="valor-dtnasc">{{ formatarData(dataNascimento) }}</span>
        </div>
      </div>

      <div class="email-info">
        <div class="icone-email">
          <ion-icon name="mail-outline"></ion-icon>
        </div>
        <div class="texto-email">
          <span class="rotulo-email">E-mail</span>
          <span class="valor-email">{{ email }}</span>
        </div>
      </div>

      <div class="genero-info">
        <div class="icone-genero">
          <ion-icon name="male-female-outline"></ion-icon>
        </div>
        <div class="texto-genero">
          <span class="rotulo-genero">Gênero</span>
          <span class="valor-genero">{{ genero }}</span>
        </div>
      </div>

      <div class="local-info">
        <div class="icone-local">
          <ion-icon name="location-outline"></ion-icon>
        </div>
        <div class="texto-local">
          <span class="rotulo-local">Endereço</span>
          <span class="valor-local">{{ endereco }}</span>
        </div>
      </div>

    </div>

    <button class="botao-sair" (click)="logout()">
      <ion-icon name="log-out-outline"></ion-icon>
      <span>Sair da Conta</span>
    </button>

  </div>

  <ion-modal [isOpen]="isModalOpen" (didDismiss)="fecharModal()" class="modal-editar">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Editar Perfil</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="fecharModal()">Fechar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding conteudo-modal">

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Nome Completo</ion-label>
            <ion-input [(ngModel)]="editNome" type="text"></ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">CPF</ion-label>
            <ion-input [(ngModel)]="editCpf" type="text" readonly="true" disabled="true"></ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Data de Nascimento</ion-label>
            <ion-input 
              [(ngModel)]="editDataNascimento" 
              type="text" 
              (ionInput)="mascaraDataNasc($event)" 
              maxlength="10"
              placeholder="DD/MM/AAAA">
            </ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Gênero</ion-label>
            <ion-select [(ngModel)]="editGenero" interface="popover">
              <ion-select-option value="Masculino">Masculino</ion-select-option>
              <ion-select-option value="Feminino">Feminino</ion-select-option>
              <ion-select-option value="Outro">Outro</ion-select-option>
            </ion-select>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">E-mail</ion-label>
            <ion-input [(ngModel)]="editEmail" type="email"></ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">CEP</ion-label>
            <ion-input 
              [(ngModel)]="editCep" 
              type="text" 
              (ionInput)="mascaraCEP($event)" 
              maxlength="9">
            </ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Logradouro</ion-label>
            <ion-input [(ngModel)]="editLogradouro" type="text"></ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Número</ion-label>
            <ion-input [(ngModel)]="editNumero" type="text"></ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Bairro</ion-label>
            <ion-input [(ngModel)]="editBairro" type="text"></ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Cidade</ion-label>
            <ion-input [(ngModel)]="editCidade" type="text"></ion-input>
          </ion-item>
        </div>

        <div class="grupo-campo">
          <ion-item lines="none" class="campo-input">
            <ion-label position="stacked">Estado</ion-label>
            <ion-input [(ngModel)]="editEstado" type="text" maxlength="2"></ion-input>
          </ion-item>
        </div>

        <div class="ion-padding-top">
          <ion-button expand="block" shape="round" (click)="salvarEdicao()">
            Salvar Alterações
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
